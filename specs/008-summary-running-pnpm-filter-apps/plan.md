---
description: 'Implementation plan template for feature development'
---

# Implementation Plan: Document Editor Deep Links And Deterministic Fixtures

**Branch**: `008-summary-running-pnpm-filter-apps` | **Date**: 2025-09-27 |
**Spec**:
[/specs/008-summary-running-pnpm-filter-apps/spec.md](/specs/008-summary-running-pnpm-filter-apps/spec.md)
**Input**: Feature specification from
`/specs/008-summary-running-pnpm-filter-apps/spec.md`

## Execution Flow (/plan command scope)

```
1. Load feature spec from Input path
   → If not found: ERROR "No feature spec at {path}"
2. Fill Technical Context (scan for NEEDS CLARIFICATION)
   → Detect Project Type from file system structure or context (web=frontend+backend, mobile=app+api)
   → Set Structure Decision based on project type
3. Fill the Constitution Check section based on the content of the constitution document.
4. Evaluate Constitution Check section below
   → If violations exist: Document in Complexity Tracking
   → If no justification possible: ERROR "Simplify approach first"
   → Update Progress Tracking: Initial Constitution Check
5. Execute Phase 0 → research.md
   → If NEEDS CLARIFICATION remain: ERROR "Resolve unknowns"
6. Execute Phase 1 → contracts, data-model.md, quickstart.md, agent-specific template file (e.g., `CLAUDE.md` for Claude Code, `.github/copilot-instructions.md` for GitHub Copilot, `GEMINI.md` for Gemini CLI, `QWEN.md` for Qwen Code or `AGENTS.md` for opencode).
7. Re-evaluate Constitution Check section
   → If new violations: Refactor design, return to Phase 1
   → Update Progress Tracking: Post-Design Constitution Check
8. Plan Phase 2 → Describe task generation approach (DO NOT create tasks.md)
9. STOP - Ready for /tasks command
```

**IMPORTANT**: The /plan command STOPS at step 7. Phases 2-4 are executed by
other commands:

- Phase 2: /tasks command creates tasks.md
- Phase 3-4: Implementation execution (manual or via tools)

## Summary

Playwright document and section editor specs fail because routes redirect to the
dashboard and live API calls leave fixtures empty. This plan introduces
`/documents/:documentId/sections/:sectionId` routing in `apps/web`, adds a
`VITE_E2E=true` execution mode that serves deterministic document fixtures, and
documents the workflow so E2E runs pass without backend dependencies as outlined
in the feature spec and issue brief.

## Technical Context

**Language/Version**: TypeScript 5.x (React 18, Vite bundler)  
**Primary Dependencies**: React Router v6, TanStack Query, Clerk auth stubs,
Playwright 1.x  
**Storage**: Local JSON/TypeScript fixture modules loaded in-browser (no remote
persistence)  
**Testing**: Playwright E2E (primary), Vitest for component coverage, pnpm
scripts  
**Target Platform**: Web app served by Vite dev server / pnpm build output in
browsers  
**Project Type**: web (React frontend backed by Express API)  
**Performance Goals**: Maintain ≤2s document load in E2E mode per
`/docs/front-end-spec.md`  
**Constraints**: E2E mode must not hit live `/api/v1/**`, must honor
authentication messaging, and must keep fixture drift aligned with `/templates/`
schemas  
**Scale/Scope**: Support at least the demo architecture document and section set
used by 234 Playwright specs, scalable to additional fixtures as tests expand

## Constitution Check

- **Library-First Architecture**: Fixture providers live under
  `apps/web/src/lib/fixtures` and expose reusable functions; no monolithic ad
  hoc scripts. PASS
- **CLI Interface Standard**: Existing libraries already have pnpm CLI exposure;
  no new backend service introduced. PASS
- **Test-First Development**: Update Playwright tests (and add new ones if
  needed) before implementation to enforce red-green cycle. PASS (requires
  enforcement during execution)
- **Observability & Logging**: Frontend logs remain structured; fixture mode
  adds explicit console warnings only when flag enabled. PASS
- **Security Rules**: Authentication prompts remain enforced; fixture mode still
  requires sign-in flows per constitution SOC2 rules. PASS

Initial Constitution Check: PASS

## Project Structure

### Documentation (this feature)

```
specs/008-summary-running-pnpm-filter-apps/
├── plan.md              # /plan output
├── research.md          # Phase 0 findings
├── data-model.md        # Phase 1 entity catalog
├── quickstart.md        # Phase 1 enablement guide
├── AGENTS.md            # Phase 1 agent guidance
├── contracts/           # Phase 1 API/fixture contracts
└── tasks.md             # Generated by /tasks (future)
```

### Source Code (repository root)

```
apps/
├── web/
│   ├── src/
│   │   ├── app/App.tsx                     # Extend router with document routes
│   │   ├── app/router/document-routes.tsx  # New route definitions & loaders
│   │   ├── lib/fixtures/e2e/               # Deterministic fixture modules
│   │   ├── providers/api/                  # ApiProvider toggle for VITE_E2E
│   │   ├── features/document-editor/       # Existing editor components consume fixtures
│   │   └── tests/e2e/                      # Playwright specs updated to use fixtures
│   └── tests/e2e/                          # Artifacts & screenshots
├── api/                                    # No code changes expected (document for clarity)
└── packages/
    ├── templates/                          # Authoritative schema references
    ├── persistence/
    └── qa/
```

**Structure Decision**: Web application rooted in `apps/web`; introduces fixture
utilities under `src/lib/fixtures/e2e` and dedicated router module so
frontend/Playwright flows remain aligned. Backend (`apps/api`) untouched but
noted to prevent accidental edits.

## Phase 0: Outline & Research

- Extracted unknowns focused on fixture governance, AI transcript behavior, and
  routing strategy.
- Generated research tasks covering: enabling `VITE_E2E`, fixture
  format/location, API interception avoidance, static AI transcript approach,
  and authentication messaging.
- Consolidated conclusions in `research.md`, including rationale and rejected
  alternatives (e.g., Playwright-only request interception).
- Outstanding NEEDS CLARIFICATION from spec resolved by choosing static
  transcripts for E2E assertions while noting future extensibility.

## Phase 1: Design & Contracts

- Documented entities `DocumentFixture`, `SectionFixture`, and
  `AssumptionSessionFixture` with required fields, relationships, and state
  markers in `data-model.md`.
- Authored `/contracts/document-fixtures.openapi.yaml` detailing fixture
  endpoints exposed when `VITE_E2E=true` (e.g.,
  `GET /__fixtures/documents/{documentId}` and
  `GET /__fixtures/documents/{documentId}/sections/{sectionId}`).
- Captured quickstart steps in `quickstart.md` describing how to enable E2E
  mode, refresh fixtures, and run targeted Playwright suites.
- Added `AGENTS.md` instructing contributors and coding agents on TDD order,
  fixture maintenance, and guardrails for real API usage.
- Post-design constitution check confirmed no new violations.

## Phase 2: Task Planning Approach

**Task Generation Strategy**:

- Seed tasks from `data-model.md` (fixture modules),
  `contracts/document-fixtures.openapi.yaml` (routing + provider logic), and
  `quickstart.md` (docs/tests).
- Ensure Playwright tests are generated first (red state), followed by fixture
  provider implementation, then router updates, and finally documentation
  refresh.
- Include regression tasks to update `/docs/front-end-spec.md` excerpts if
  fixture UX changes.

**Ordering Strategy**:

1. Author failing Playwright specs covering deep-link navigation and fixture
   assertions.
2. Implement fixture loading modules and API provider toggle.
3. Wire new routes in `App.tsx` and nested router.
4. Update DocumentEditor consumption paths and provide error states.
5. Refresh docs/tests per quickstart.

**Estimated Output**: 24–28 ordered tasks with [P] markers for parallelizable
fixture authoring vs. routing work.

## Phase 3+: Future Implementation

**Phase 3**: Execute `/tasks` to populate tasks.md  
**Phase 4**: Implement fixtures, routing, and Playwright updates under TDD  
**Phase 5**: Validate via `pnpm --filter @ctrl-freaq/web test:e2e` and manual
deep-link smoke tests

## Complexity Tracking

_No deviations requiring constitutional justification at this stage._

## Progress Tracking

**Phase Status**:

- [x] Phase 0: Research complete (/plan command)
- [x] Phase 1: Design complete (/plan command)
- [x] Phase 2: Task planning complete (/plan command - describe approach only)
- [ ] Phase 3: Tasks generated (/tasks command)
- [ ] Phase 4: Implementation complete
- [ ] Phase 5: Validation passed

**Gate Status**:

- [x] Initial Constitution Check: PASS
- [x] Post-Design Constitution Check: PASS
- [x] All NEEDS CLARIFICATION resolved (static transcript decision recorded in
      spec)
- [ ] Complexity deviations documented

---

_Based on Constitution v2.1.1 - See `SPEC_KIT_CONFIG.constitution.path`_
